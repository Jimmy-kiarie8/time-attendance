import{r as ref,D as reactive,s as watch,i as resolveComponent,o as openBlock,c as createBlock,w as withCtx,V as axios,b as createVNode,f as createTextVNode,t as toDisplayString,d as createElementBlock,g as renderList,a as createBaseVNode,F as Fragment,e as createCommentVNode}from"./app-C40yS1Zs.js";import{_ as _sfc_main$1}from"./FormComponent-BXJpgamY.js";import myDocs from"./documents-D00fmact.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const _sfc_main={__name:"create",props:{formData:{type:Array,required:!0},modelRoute:{type:String,required:!0},title:{type:String,required:!0},modalWidth:{type:Number,required:!0}},emits:["refresh"],setup(__props,{expose:__expose,emit:__emit}){const props=__props,dialog=ref(!1),snackbar=ref(!1),text=ref("Updated"),color=ref("black"),loading=ref(!1),defaultFormState=props.formData.reduce((e,t)=>(t.type==="file"?e[t.model]=t.multiple?[]:null:e[t.model]=t.value||"",e),{}),form=reactive({...defaultFormState}),errors=ref(null),guarantors=ref(null),fileRefs=reactive({}),documentModal=ref(null);props.formData.forEach(e=>{e.type==="file"?(form[e.model]=e.multiple?[]:null,fileRefs[e.model]=ref(null)):form[e.model]=e.value});function showDocumentModal(e){var t;(t=documentModal.value)==null||t.show(e)}props.formData.forEach(item=>{if(item.fetch&&watch(()=>form[item.model],async e=>{e&&await fetchData(item.fetch.url,e,item.fetch.target_fields)}),item.calculation){const{depends_on,formula,target_field}=item.calculation;watch(depends_on.map(e=>()=>form[e]),()=>{const calculatedValue=eval(formula.replace(/\b(amount|installments|interest_rate|total_payment)\b/g,e=>form[e]));form[target_field]=calculatedValue})}if(item.interest){const{depends_on:e,target_field:t}=item.interest;watch(e.map(o=>()=>form[o]),()=>{const o=parseFloat(form.amount),r=parseInt(form.installments),l=parseFloat(form.interest_rate)/100;if(r===1){const a=o*l,s=o+a;form[t]=s}else{let a=0,s=o;for(let c=1;c<=r;c++){const i=o/r,d=s*l,m=i+d;a+=m,s-=i}form[t]=a}})}});async function fetchData(e,t,o){try{const l=(await axios.get(`${e}/${t}`)).data;o.forEach(a=>{form[a]=l[a]}),l.guarantors&&(guarantors.value=l.guarantors)}catch(r){console.error("Failed to fetch data:",r)}}function submit(){errors.value=null,loading.value=!0,axios.post(`/${props.modelRoute}`,form).then(e=>{snackbar.value=!0,color.value="success",text.value="Created",props.modelRoute==="loans"&&(console.log(e.data),showDocumentModal(e.data))}).catch(e=>{console.log(e),e.response.status===422?text.value=e.response.data.message:text.value="Something went wrong",errors.value=e.response.data.errors,snackbar.value=!0,color.value="error"}).finally(()=>{loading.value=!1})}function show(){dialog.value=!0}function close(){dialog.value=!1}return __expose({show}),(e,t)=>{const o=resolveComponent("v-divider"),r=resolveComponent("v-card-title"),l=resolveComponent("v-list-item-title"),a=resolveComponent("v-list-item"),s=resolveComponent("v-list"),c=resolveComponent("v-card"),i=resolveComponent("v-card-text"),d=resolveComponent("v-icon"),m=resolveComponent("v-btn"),p=resolveComponent("v-spacer"),f=resolveComponent("v-card-actions"),_=resolveComponent("v-dialog"),v=resolveComponent("v-snackbar"),g=resolveComponent("v-row");return openBlock(),createBlock(g,{justify:"center"},{default:withCtx(()=>[createVNode(_,{persistent:"",modelValue:dialog.value,"onUpdate:modelValue":t[1]||(t[1]=n=>dialog.value=n),width:__props.modalWidth},{default:withCtx(()=>[createVNode(o),createVNode(c,null,{default:withCtx(()=>[createVNode(r,{class:"text-h5"},{default:withCtx(()=>[createTextVNode(" Create A "+toDisplayString(__props.title),1)]),_:1}),createVNode(i,null,{default:withCtx(()=>[errors.value?(openBlock(),createBlock(c,{key:0,color:"error",variant:"tonal"},{default:withCtx(()=>[createVNode(s,{density:"compact"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(errors.value,(n,u)=>(openBlock(),createBlock(a,{key:u,value:u,color:"error"},{default:withCtx(()=>[createVNode(l,null,{default:withCtx(()=>[createBaseVNode("ul",null,[(openBlock(!0),createElementBlock(Fragment,null,renderList(n,(x,C)=>(openBlock(),createElementBlock("li",{key:C},toDisplayString(x),1))),128))])]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})):createCommentVNode("",!0),createVNode(o),createVNode(_sfc_main$1,{formData:__props.formData,form,"onUpdate:form":t[0]||(t[0]=n=>form=n),guarantors:guarantors.value},null,8,["formData","form","guarantors"])]),_:1}),createVNode(f,null,{default:withCtx(()=>[createVNode(m,{variant:"outlined",color:"red",onClick:close},{default:withCtx(()=>[createVNode(d,null,{default:withCtx(()=>t[3]||(t[3]=[createTextVNode("mdi-checkbox-marked")])),_:1}),t[4]||(t[4]=createTextVNode(" Close "))]),_:1}),createVNode(p),createVNode(m,{variant:"outlined",color:"primary",onClick:submit,loading:loading.value},{default:withCtx(()=>[createVNode(d,null,{default:withCtx(()=>t[5]||(t[5]=[createTextVNode("mdi-plus-circle")])),_:1}),t[6]||(t[6]=createTextVNode(" Submit "))]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue","width"]),createVNode(myDocs,{ref_key:"documentModal",ref:documentModal},null,512),createVNode(v,{modelValue:snackbar.value,"onUpdate:modelValue":t[2]||(t[2]=n=>snackbar.value=n),color:color.value},{default:withCtx(()=>[createTextVNode(toDisplayString(text.value),1)]),_:1},8,["modelValue","color"])]),_:1})}}};export{_sfc_main as default};
