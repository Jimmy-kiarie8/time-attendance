import{_ as S}from"./MainLayout-BrCLmlwd.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{i as d,o as p,c as m,w as o,b as s,d as k,g as O,e as g,F as A,a as _,f as l,t as u}from"./app-DTApRKiJ.js";const B={props:{reports:Object,locations:Object,form_data:Object},components:{MainLayout:S},data(){return{report_data:[],headers:[],search:"",page:1,loading:!1,itemsPerPage:5,statuses:["Scheduled","Cancelled","Delivered","Returned","Dispatched"]}},methods:{statusUpdate(a){this.$refs.statusModal.show(a)},updateLocation(a){this.$refs.locationModal.show(a)},getIcon(a){switch(a){case"delivered":return"mdi-check-circle";case"cancelled":return"mdi-cancel";case"returned":return"mdi-undo";case"Scheduled":return"mdi-clock";case"Dispatched":return"mdi-send";default:return"mdi-information"}},getColor(a){switch(a){case"delivered":return"success";case"cancelled":return"error";case"returned":return"error";case"Scheduled":return"primary";case"Dispatched":return"warning";default:return""}},async downloadReport(a){this.loading=!0;try{const e=this.form_data.reduce((n,i)=>(Array.isArray(i.value)?n[i.model]=i.value.map(h=>h.value):i.value&&typeof i.value=="object"?n[i.model]=i.value.value:n[i.model]=i.value,n),{}),r=await axios.post(`/report-download?filetype=${a}`,e,{responseType:"blob"}),v=new Blob([r.data],{type:a==="pdf"?"application/pdf":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=window.URL.createObjectURL(v);if(a==="pdf")window.open(c,"_blank");else{const n=document.createElement("a");n.href=c,n.setAttribute("download",`Report_${new Date().toISOString()}.xlsx`),document.body.appendChild(n),n.click(),document.body.removeChild(n)}window.URL.revokeObjectURL(c),this.loading=!1}catch(e){this.loading=!1,console.error("Error downloading report:",e)}},generate(){this.loading=!0;const a=this.form_data.reduce((e,r)=>(Array.isArray(r.value)?e[r.model]=r.value.map(v=>v.value):r.value&&typeof r.value=="object"?e[r.model]=r.value.value:e[r.model]=r.value,e),{});console.log(a),axios.post("/report",a).then(e=>{this.loading=!1,this.headers=e.data.headers,this.report_data=e.data}).catch(e=>{this.loading=!1})}},computed:{pageCount(){return Math.ceil(this.reports.data.length/this.itemsPerPage)}}},P={style:{"text-align":"center"}},E={key:0,class:"overflow-hidden shadow-xl sm:rounded-lg"},N={id:"tooltip"},z={id:"tooltip"},F={id:"tooltip"},I={id:"tooltip"},T={id:"tooltip"};function $(a,e,r,v,c,n){const i=d("v-autocomplete"),h=d("v-text-field"),w=d("v-col"),V=d("v-row"),y=d("v-btn"),C=d("v-card-text"),R=d("v-card"),L=d("v-skeleton-loader"),f=d("v-tooltip"),x=d("v-icon"),U=d("v-data-table"),j=d("MainLayout");return p(),m(j,{title:"Reports"},{default:o(()=>[s(R,{class:"mx-auto",loading:c.loading},{default:o(()=>[s(C,null,{default:o(()=>[s(V,null,{default:o(()=>[(p(!0),k(A,null,O(r.form_data,(t,D)=>(p(),m(w,{key:D,cols:"12",sm:"4"},{default:o(()=>[t.type=="select"?(p(),m(i,{key:0,clearable:"",chips:"",label:t.label,items:t.items,variant:"outlined","item-title":"label","item-value":"value",modelValue:t.value,"onUpdate:modelValue":b=>t.value=b,multiple:t.multiple,"return-object":"",density:"compact"},null,8,["label","items","modelValue","onUpdate:modelValue","multiple"])):g("",!0),t.type=="date"?(p(),m(h,{key:1,clearable:"",label:t.label,variant:"outlined",modelValue:t.value,"onUpdate:modelValue":b=>t.value=b,density:"compact",type:"date"},null,8,["label","modelValue","onUpdate:modelValue"])):g("",!0)]),_:2},1024))),128)),s(w)]),_:1}),_("div",P,[s(y,{"prepend-icon":"mdi-magnify",variant:"tonal",onClick:e[0]||(e[0]=t=>n.generate())},{default:o(()=>e[3]||(e[3]=[l(" Search ")])),_:1}),s(y,{"prepend-icon":"mdi-file-excel",variant:"tonal",onClick:e[1]||(e[1]=t=>n.downloadReport("excel")),style:{"margin-left":"6px"}},{default:o(()=>e[4]||(e[4]=[l(" Excel ")])),_:1}),s(y,{"prepend-icon":"mdi-file-pdf-box",variant:"tonal",onClick:e[2]||(e[2]=t=>n.downloadReport("pdf")),style:{"margin-left":"6px"}},{default:o(()=>e[5]||(e[5]=[l(" Pdf ")])),_:1})])]),_:1})]),_:1},8,["loading"]),e[8]||(e[8]=_("br",null,null,-1)),c.report_data?(p(),k("div",E,[c.loading?(p(),m(L,{key:0,type:"table"})):(p(),m(U,{key:1,headers:c.headers,items:c.report_data.data,"sort-by":[{key:"product_name",order:"asc"}],class:"elevation-2",search:c.search},{"item.description":o(({value:t})=>[_("p",N,[l(u(t)+" ",1),s(f,{activator:"parent",location:"top"},{default:o(()=>[l(u(t),1)]),_:2},1024)])]),"item.short_description":o(({value:t})=>[_("p",z,[l(u(t)+" ",1),s(f,{activator:"parent",location:"top"},{default:o(()=>[l(u(t),1)]),_:2},1024)])]),"item.paid":o(({value:t})=>[t?(p(),m(x,{key:0,color:"success",size:"x-small"},{default:o(()=>e[6]||(e[6]=[l("mdi-circle")])),_:1})):(p(),m(x,{key:1,color:"red",size:"x-small"},{default:o(()=>e[7]||(e[7]=[l("mdi-circle")])),_:1}))]),"item.notes":o(({value:t})=>[_("p",F,[l(u(t)+" ",1),s(f,{activator:"parent",location:"top"},{default:o(()=>[l(u(t),1)]),_:2},1024)])]),"item.customer_notes":o(({value:t})=>[_("p",I,[l(u(t)+" ",1),s(f,{activator:"parent",location:"top"},{default:o(()=>[l(u(t),1)]),_:2},1024)])]),"item.client_address":o(({value:t})=>[_("p",T,[l(u(t)+" ",1),s(f,{activator:"parent",location:"top"},{default:o(()=>[l(u(t),1)]),_:2},1024)])]),_:1},8,["headers","items","search"]))])):g("",!0)]),_:1})}const J=M(B,[["render",$]]);export{J as default};
