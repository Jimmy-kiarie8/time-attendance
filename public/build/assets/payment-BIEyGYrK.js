import{_ as _sfc_main$1}from"./FormComponent-BXJpgamY.js";import{r as ref,D as reactive,s as watch,i as resolveComponent,o as openBlock,c as createBlock,w as withCtx,V as axios,b as createVNode,f as createTextVNode,t as toDisplayString}from"./app-C40yS1Zs.js";const _sfc_main={__name:"payment",emits:["refresh"],setup(__props,{expose:__expose,emit:__emit}){const dialog=ref(!1),snackbar=ref(!1),text=ref("Updated"),color=ref("black"),loading=ref(!1),formData=ref([]),defaultFormState={reference:"",id_no:"",client_id:"",branch_id:"",loan_id:"",repayment_amount:"",method:"",date:"",officer_id:""},form=reactive({...defaultFormState}),emit=__emit;async function fetchJson(){const e="/json-data?file=payments.json";try{const t=await axios.get(`${e}`);formData.value=t.data}catch(t){console.error("Failed to fetch data:",t)}}function resetForm(){Object.assign(form,defaultFormState)}watch(formData,newFormData=>{newFormData.forEach(item=>{if(item.fetch&&watch(()=>form[item.model],async e=>{e&&await fetchData(item.fetch.url,e,item.fetch.target_fields)}),item.calculation){const{depends_on,formula,target_field}=item.calculation;watch(depends_on.map(e=>()=>form[e]),()=>{const calculatedValue=eval(formula.replace(/\b(amount|installments)\b/g,e=>form[e]));form[target_field]=calculatedValue})}})},{immediate:!0,deep:!0});async function fetchData(e,t,r){try{const l=(await axios.get(`${e}/${t}`)).data;r.forEach(o=>{form[o]=l[o]})}catch(n){console.error("Failed to fetch data:",n)}}function submit(){loading.value=!0,axios.post("/processPayment",form).then(e=>{snackbar.value=!0,color.value="success",text.value=e.data.message?e.data.message:"Updated",loading.value=!1,emit("refresh",!1),resetForm(),dialog.value=!1}).catch(e=>{console.error(e),loading.value=!1,snackbar.value=!0,color.value="error",text.value="Something went wrong!"})}function show(e){fetchJson(),form.client_id=e.client_id,form.loan_id=e.id,form.branch_id=e.branch_id,form.officer_id=e.officer_id,form.amount=e.amount,form.balance=e.balance,fetchData("clients",2,["id_no","officer_id","branch_id"]),dialog.value=!0}function close(){dialog.value=!1}return __expose({show}),(e,t)=>{const r=resolveComponent("v-divider"),n=resolveComponent("v-card-title"),l=resolveComponent("v-card-text"),o=resolveComponent("v-icon"),c=resolveComponent("v-btn"),s=resolveComponent("v-spacer"),i=resolveComponent("v-card-actions"),d=resolveComponent("v-card"),m=resolveComponent("v-dialog"),f=resolveComponent("v-snackbar"),u=resolveComponent("v-row");return openBlock(),createBlock(u,{justify:"center"},{default:withCtx(()=>[createVNode(m,{persistent:"",modelValue:dialog.value,"onUpdate:modelValue":t[1]||(t[1]=a=>dialog.value=a),width:"900"},{default:withCtx(()=>[createVNode(r),createVNode(d,null,{default:withCtx(()=>[createVNode(n,{class:"text-h5"},{default:withCtx(()=>t[3]||(t[3]=[createTextVNode(" Loan Re-payment ")])),_:1}),createVNode(l,null,{default:withCtx(()=>[createVNode(_sfc_main$1,{formData:formData.value,form,"onUpdate:form":t[0]||(t[0]=a=>form=a)},null,8,["formData","form"])]),_:1}),createVNode(i,null,{default:withCtx(()=>[createVNode(c,{variant:"outlined",color:"red",onClick:close},{default:withCtx(()=>[createVNode(o,null,{default:withCtx(()=>t[4]||(t[4]=[createTextVNode("mdi-checkbox-marked")])),_:1}),t[5]||(t[5]=createTextVNode(" Close "))]),_:1}),createVNode(s),createVNode(c,{variant:"outlined",color:"primary",onClick:submit,loading:loading.value},{default:withCtx(()=>[createVNode(o,null,{default:withCtx(()=>t[6]||(t[6]=[createTextVNode("mdi-plus-circle")])),_:1}),t[7]||(t[7]=createTextVNode(" Submit "))]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),createVNode(f,{modelValue:snackbar.value,"onUpdate:modelValue":t[2]||(t[2]=a=>snackbar.value=a),color:color.value},{default:withCtx(()=>[createTextVNode(toDisplayString(text.value),1)]),_:1},8,["modelValue","color"])]),_:1})}}};export{_sfc_main as default};
