import q from"./edit-Cy_00TZ7.js";import G from"./payment-BIEyGYrK.js";import H from"./reschedule-Cdm-Y0gu.js";import J from"./show-CI3xN_NI.js";import Q from"./loan-editor-BtEJIZp5.js";import{V as b,i as a,o as _,d as R,c as p,ad as X,w as t,b as l,a as d,t as r,f as s,y as v,F as Y,g as Z,e as $}from"./app-C40yS1Zs.js";import ee from"./documents-D00fmact.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./FormComponent-BXJpgamY.js";import"./statement-DGkpOG_O.js";import"./payments-CR_igQO_.js";import"./penalties-Cwf6Ko_F.js";const oe={components:{componentEdit:q,myPayment:G,myRechedule:H,myLoan:J,myLoanEditor:Q,myDocs:ee},props:{tableData:Object,formData:Object,headers:Object,modelRoute:String,title:String,loading:Boolean,upload:Boolean,canCreate:Boolean,actions:Object,modalWidth:Number},data(){return{search:"",page:1,sortBy:[{key:"reference",order:"desc"}],dialogDelete:!1,selected:[],itemsPerPage:5,editedIndex:-1,editedItem:{},dialogConfirm:!1,snackbar:!1,text:"Updated",color:"black",current_data:null,current_route:null,warning_text:"Are you sure you want to delete this item"}},methods:{reverse(o){this.dialogConfirm=!0,this.current_data=o,this.current_route=`reverse/${o.id}`,this.warning_text="Are you sure you want to reverse",action_run(o,route)},shouldShowButton(o,e){return e.show?Array.isArray(e.show.value)?e.show.value.includes(o[e.show.label]):e.show.value===o[e.show.label]:!0},getIcon(o){switch(o){case"Paid":return"mdi-check-circle";case"Rejected":return"mdi-cancel";case"Disbursed":return"mdi-arrow-bottom-right-bold-box";case"Over paid":return"mdi-debug-step-over";case"Pending":return"mdi-help-box";default:return"mdi-information"}},getColor(o){switch(o){case"Paid":return"success";case"Rejected":return"error";case"Disbursed":return"secondary";case"Over paid":return"primary";case"Pending":return"warning";default:return""}},valueInArray(o,e){e.some(function(i){return console.log(o,i),console.log(i===o),i===o})},async refresh(){this.$emit("refresh",!1)},runAction(o,e){e.action_name=="Edit"?this.openEdit(o):e.action_name=="Delete"?this.deleteItem(o):e.action_name=="View Loan"?this.openShow(o):e.action_name=="Documents"?this.upenDocument(o):e.action_name=="Logo"?this.uploadImage(o):e.action_name=="Password"?this.passwordReset(o,e.route):e.action_name=="Repay Loan"?this.openPayment(o,e.route):e.action_name=="Reschedule"?this.rescheduleLoan(o,e.route):e.action_name=="View Loan"?this.openLoan(o,e.route):e.action_name=="Approve"||e.action_name=="Reject"||e.action_name=="Disburse"?(this.dialogConfirm=!0,this.current_data=o,this.current_route=e.route,this.warning_text=`Are you sure you want to ${e.action_name}`):e.action_name=="Open File"?window.open(o.path,"_blank"):this.action_run(o,e.route)},async action_run(o,e){this.$props.loading=!0,this.dialogConfirm=!1;try{const i=await b.post(`/${e}`,o);console.log("ðŸš€ ~ dispatch ~ response:",i),this.refresh(),this.snackbar=!0,this.color="success",this.text=i.data.message??"Updated"}catch(i){console.log("ðŸš€ ~ axios.get ~ error:",i),this.snackbar=!0,this.color="error",this.text="Something went wrong!"}finally{this.$props.loading=!1}},goTo(o){router.visit(o)},openEdit(o){this.$refs.editModal.show(o)},openShow(o){this.$refs.showModal.show(o)},upenDocument(o){this.$refs.documentModal.show(o)},openPayment(o,e){this.$refs.paymentModal.show(o,e)},openLoan(o,e){this.$refs.showModal.show(o,e)},rescheduleLoan(o,e){this.$refs.rescheduleModal.show(o,e)},deleteItem(o){this.editedIndex=this.data.data.indexOf(o),this.editedItem=Object.assign({},o),this.dialogDelete=!0},deleteItemConfirm(){b.delete(`${this.modelRoute}/${this.editedItem.id}`).then(o=>{console.log("ðŸš€ ~ axios.delete ~ res:",o),this.dialogDelete=!0,this.data.data.splice(this.editedIndex,1),this.close()}).catch(o=>{console.log("ðŸš€ ~ axios.delete ~ error:",o)})},actionConfirm(o,e){this.action_run(o,e)},close(){this.dialogDelete=!1},uploadItem(){this.$refs.uploadModal.show()},editLoan(o,e){this.$refs.editLoanModal.show(o,e)}}},ne={class:"actions"},le={style:{width:"70px","font-size":"13px"}},ie={style:{display:"flex","align-items":"center",width:"90px"}},se={style:{display:"flex","align-items":"center",width:"90px"}},ae={style:{display:"flex","align-items":"center",width:"90px"}},re={style:{display:"flex","align-items":"center",width:"90px"}},de={style:{display:"flex","align-items":"center",width:"90px"}},me={style:{display:"flex","align-items":"center",width:"90px"}},ue={style:{display:"flex","align-items":"center",width:"90px"}},ce={style:{display:"flex","align-items":"center",width:"90px"}},fe={style:{display:"flex","align-items":"center",width:"90px"}},_e={style:{display:"flex","align-items":"center",width:"90px"}},pe={style:{display:"flex","align-items":"center",width:"90px"}},he={style:{display:"flex","align-items":"center",width:"90px"}},ye={style:{display:"flex","align-items":"center",width:"90px"}},ve={style:{display:"flex","align-items":"center",width:"90px"}};function ge(o,e,i,xe,m,c){const C=a("v-skeleton-loader"),S=a("v-text-field"),u=a("v-icon"),h=a("v-btn"),y=a("v-tooltip"),g=a("v-list-item-title"),x=a("v-list-item"),E=a("v-list"),L=a("v-menu"),V=a("v-chip"),D=a("v-data-table"),P=a("componentEdit"),I=a("myPayment"),M=a("myRechedule"),z=a("myLoan"),K=a("myDocs"),A=a("myLoanEditor"),B=a("v-snackbar"),O=a("v-card-title"),k=a("v-divider"),j=a("v-card-text"),W=a("v-spacer"),U=a("v-card-actions"),N=a("v-card"),T=a("v-dialog");return _(),R("div",null,[i.loading?(_(),p(C,{key:0,type:"table"})):(_(),p(D,{key:1,headers:i.headers,items:i.tableData.data,"sort-by":[{key:"reference",order:"desc"}],class:"elevation-2 sticky-table",search:m.search,loading:i.loading,"show-select":i.modelRoute==="loans"||i.modelRoute==="clients",modelValue:m.selected,"onUpdate:modelValue":e[1]||(e[1]=n=>m.selected=n)},X({top:t(()=>[l(S,{modelValue:m.search,"onUpdate:modelValue":e[0]||(e[0]=n=>m.search=n),"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":"",variant:"outlined",density:"compact"},null,8,["modelValue"])]),"item.actions":t(({item:n})=>[d("div",ne,[(_(!0),R(Y,null,Z(i.actions,(f,w)=>(_(),p(y,{key:w,location:"bottom"},{activator:t(({props:F})=>[c.shouldShowButton(n,f)?(_(),p(h,v({key:0,icon:"",ref_for:!0},F,{onClick:we=>c.runAction(n,f),variant:"text",color:f.color}),{default:t(()=>[l(u,null,{default:t(()=>[s(r(f.icon),1)]),_:2},1024)]),_:2},1040,["onClick","color"])):$("",!0)]),default:t(()=>[d("span",null,r(f.action_name),1)]),_:2},1024))),128))])]),"item.overpayment_amount":t(({item:n})=>[d("div",me,[l(h,{color:"warning",size:"small",variant:"outlined",onClick:f=>c.reverse(n)},{default:t(()=>[s(r(o.$formatKES(n.overpayment_amount))+" ",1),l(y,{activator:"parent",location:"bottom"},{default:t(()=>e[16]||(e[16]=[s("Reverse")])),_:1})]),_:2},1032,["onClick"])])]),"item.repayment_amount":t(({item:n})=>[d("div",ce,r(o.$formatKES(n.repayment_amount)),1)]),"item.loan.amount":t(({item:n})=>[d("div",fe,r(o.$formatKES(n.loan.amount)),1)]),"item.TransAmount":t(({item:n})=>[d("div",_e,r(o.$formatKES(n.TransAmount)),1)]),"item.loan.overpayment_amount":t(({item:n})=>[d("div",pe,r(o.$formatKES(n.loan.overpayment_amount)),1)]),"item.interest":t(({item:n})=>[d("div",he,r(o.$formatKES(n.interest)),1)]),"item.balance":t(({item:n})=>[d("div",ye,r(o.$formatKES(n.balance)),1)]),"item.amount":t(({item:n})=>[d("div",ve,r(o.$formatKES(n.amount)),1)]),"item.status":t(({value:n})=>[l(V,{color:c.getColor(n),"prepend-icon":c.getIcon(n)},{default:t(()=>[s(r(n),1)]),_:2},1032,["color","prepend-icon"])]),"item.code_used":t(({value:n})=>[n?(_(),p(u,{key:0,color:"success",size:"x-small"},{default:t(()=>e[17]||(e[17]=[s("mdi-circle")])),_:1})):(_(),p(u,{key:1,color:"red",size:"x-small"},{default:t(()=>e[18]||(e[18]=[s("mdi-circle")])),_:1}))]),"item.active":t(({value:n})=>[n?(_(),p(u,{key:0,color:"success",size:"x-small"},{default:t(()=>e[19]||(e[19]=[s("mdi-circle")])),_:1})):(_(),p(u,{key:1,color:"red",size:"x-small"},{default:t(()=>e[20]||(e[20]=[s("mdi-circle")])),_:1}))]),"item.is_main":t(({value:n})=>[n?(_(),p(u,{key:0,color:"success",size:"x-small"},{default:t(()=>e[21]||(e[21]=[s("mdi-circle")])),_:1})):(_(),p(u,{key:1,color:"red",size:"x-small"},{default:t(()=>e[22]||(e[22]=[s("mdi-circle")])),_:1}))]),_:2},[i.modelRoute==="loans"?{name:"item.application_date",fn:t(({item:n})=>[d("div",le,r(n.application_date),1)]),key:"0"}:void 0,i.modelRoute==="loans"?{name:"item.reference",fn:t(({item:n})=>[d("div",ie,[l(h,{variant:"tonal",size:"small",color:"primary",onClick:f=>c.openShow(n)},{default:t(()=>[s(r(n.reference),1)]),_:2},1032,["onClick"]),l(L,null,{activator:t(({props:f})=>[l(h,v({icon:"mdi-dots-vertical",variant:"text",color:"primary"},f),null,16)]),default:t(()=>[l(E,{density:"compact"},{default:t(()=>[l(x,{color:"primary",href:"/statement/"+n.id+"?type=Client",target:"_blank"},{prepend:t(()=>[l(u,null,{default:t(()=>e[6]||(e[6]=[s("mdi-card-account-details")])),_:1})]),default:t(()=>[l(g,null,{default:t(()=>e[7]||(e[7]=[s("Client statement")])),_:1})]),_:2},1032,["href"]),l(x,{color:"primary",href:"/statement/"+n.id+"?type=Combined",target:"_blank"},{prepend:t(()=>[l(u,null,{default:t(()=>e[8]||(e[8]=[s("mdi-printer")])),_:1})]),default:t(()=>[l(g,null,{default:t(()=>e[9]||(e[9]=[s("Combined Statement")])),_:1})]),_:2},1032,["href"]),l(x,{color:"primary",href:"/statement/"+n.id+"?type=Payment",target:"_blank"},{prepend:t(()=>[l(u,null,{default:t(()=>e[10]||(e[10]=[s("mdi-cash-clock")])),_:1})]),default:t(()=>[l(g,null,{default:t(()=>e[11]||(e[11]=[s("Payment Schedule")])),_:1})]),_:2},1032,["href"])]),_:2},1024)]),_:2},1024)])]),key:"1"}:void 0,i.modelRoute==="loans"?{name:"item.branch.name",fn:t(({item:n})=>[d("div",se,[s(r(n.branch.name)+" ",1),l(y,{location:"bottom"},{activator:t(({props:f})=>[l(h,v({icon:""},f,{variant:"text",color:"info",size:"x-small",onClick:w=>c.editLoan(n,"branch")}),{default:t(()=>[l(u,{size:"x-small"},{default:t(()=>e[12]||(e[12]=[s("mdi-pen")])),_:1})]),_:2},1040,["onClick"])]),default:t(()=>[e[13]||(e[13]=d("span",null,"Edit Branch",-1))]),_:2},1024)])]),key:"2"}:void 0,i.modelRoute==="loans"?{name:"item.officer.name",fn:t(({item:n})=>[d("div",ae,[s(r(n.officer.name)+" ",1),l(y,{location:"bottom"},{activator:t(({props:f})=>[l(h,v({icon:""},f,{variant:"text",color:"info",size:"x-small",onClick:w=>c.editLoan(n,"officer")}),{default:t(()=>[l(u,{size:"x-small"},{default:t(()=>e[14]||(e[14]=[s("mdi-pen")])),_:1})]),_:2},1040,["onClick"])]),default:t(()=>[e[15]||(e[15]=d("span",null,"Edit Officer",-1))]),_:2},1024)])]),key:"3"}:void 0,i.modelRoute==="loans"?{name:"item.payment_per_installment",fn:t(({item:n})=>[d("div",re,r(o.$formatKES(n.payment_per_installment)),1)]),key:"4"}:void 0,i.modelRoute==="loans"?{name:"item.arrears_amount",fn:t(({item:n})=>[d("div",de,r(o.$formatKES(n.arrears_amount)),1)]),key:"5"}:void 0,i.modelRoute==="loans"?{name:"item.payments_sum_repayment_amount",fn:t(({item:n})=>[d("div",ue,r(o.$formatKES(n.payments_sum_repayment_amount)),1)]),key:"6"}:void 0]),1032,["headers","items","search","loading","show-select","modelValue"])),l(P,{ref:"editModal",modalWidth:i.modalWidth,modelRoute:i.modelRoute,title:i.title,onRefresh:c.refresh},null,8,["modalWidth","modelRoute","title","onRefresh"]),l(I,{ref:"paymentModal",onRefresh:c.refresh},null,8,["onRefresh"]),l(M,{ref:"rescheduleModal",onRefresh:c.refresh},null,8,["onRefresh"]),l(z,{modalWidth:i.modalWidth,ref:"showModal",modelRoute:i.modelRoute},null,8,["modalWidth","modelRoute"]),l(K,{ref:"documentModal"},null,512),l(A,{ref:"editLoanModal",onRefresh:c.refresh},null,8,["onRefresh"]),l(B,{modelValue:m.snackbar,"onUpdate:modelValue":e[2]||(e[2]=n=>m.snackbar=n),color:m.color},{default:t(()=>[s(r(m.text),1)]),_:1},8,["modelValue","color"]),l(T,{modelValue:m.dialogConfirm,"onUpdate:modelValue":e[5]||(e[5]=n=>m.dialogConfirm=n),"max-width":"400px"},{default:t(()=>[l(N,null,{default:t(()=>[l(O,{class:"text-h5"},{default:t(()=>e[23]||(e[23]=[s("Warning!")])),_:1}),l(k),l(j,null,{default:t(()=>[s(r(m.warning_text)+"? ",1)]),_:1}),l(k),l(U,null,{default:t(()=>[l(h,{color:"red-darken-1",variant:"tonal",onClick:e[3]||(e[3]=n=>m.dialogConfirm=!1)},{default:t(()=>[l(u,null,{default:t(()=>e[24]||(e[24]=[s("mdi-close-box")])),_:1}),e[25]||(e[25]=s("Cancel "))]),_:1}),l(W),l(h,{color:"primary",variant:"tonal",onClick:e[4]||(e[4]=n=>c.actionConfirm(m.current_data,m.current_route))},{default:t(()=>[l(u,null,{default:t(()=>e[26]||(e[26]=[s("mdi-checkbox-marked")])),_:1}),e[27]||(e[27]=s("OK "))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const ze=te(oe,[["render",ge]]);export{ze as default};
